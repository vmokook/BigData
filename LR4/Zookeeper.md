# Лабораторная работа 4

## 1. Проблема обедающих философов (каждый философ - отдельный процесс в системе). 
За круглым столом сидят шесть философов (процессы). На столе шесть тарелок с едой и шесть вилок.
В каждый момент философ может либо хотеть есть (тогда ему необходимо две вилки), либо хотеть думать
(для этого ему нужен только он сам). Философы не разговаривают между собой. Необходимо, чтобы
все философы поели и не возникло драки за вилки.

Имеется 7 философов каждый из которых представляется в виде отдельного потока (Thread). 
Вилки представляют собой Mutex - ы. Их общее количество равно количеству философов (т.е. 7). 
Каждый философ чередует две основные фазы - "еда" и "думание". Когда философ решает поесть, 
он создает эфемерный узел (в методе eat()), после чего с помощью метода aquire() 
филосов берет правую и левую вилку. И после успешного взятия он переходит к фазе поедания, 
где поток "засыпает" на некоторое время. После еды философ поочередно кладет каждую из вилок обратно на стол, 
освобождая мьютексы с помощью метода release(). После этого философ переходит в фазу "думания". 
В методе think(), который вызывается после того, как эфемерный узел удаляется из ZooKeeper, поток снова "засыпает", 
представляя, что философ ушел думать.

![1](https://github.com/vmokook/BigData/blob/main/LR4/files/1.jpg)

## 2. Двухфазный коммит 

1. Фаза подготовки.
Координатор сообщает всем, что транзакция готовится начаться. Каждый исполнитель сохраняет состояние
транзакции и говорит координатору, что он готов выполнить транзакцию (commit) или отказывается (abort).
- Координатор уведомляет исполнителей о транзакции;
- Координатор подписывается на изменения транзакционного узла (устанавливает WATCH на /app/tx);
- Каждый исполнитель создает эфемерных узел /app/tx/node_i с решением commit/abort;
- Исполнитель подписывается на события своего узла для получения решения от координатора ( вторая фаза ).

## 2. Фаза коммита. 
Если все уисполнители согласны (подтвердили транзакцию в фазе подготовки), то координатор говорит всем применить изменения. В противном случае,
если хоть один участник не согласен (abort), то все откатывают транзакцию. Каждый исполнитель применяет изменения и отправляет подтверждающий ответ координатору.
- Координатор регистрирует транзакционный узел /app/tx
- Координатор принимает решение о commit/abort после ожидания таймаута или после создания всех узлов исполнителей с решением commit
- Координатор изменяет значение эфемерных узлов для каждого исполнителя на commit / abort
- Исполнители применяют / прерывают транзакцию
- Исполнители обновляют значение узла на committed

Все файлы расположены в папке [/files](https://github.com/vmokook/BigData/tree/main/LR4/files) 







