# Лабораторная работа 1

Работа начинается с инициализации сессии и загрузки необходимых данных: 

![1](https://github.com/vmokook/BigData/blob/main/LR1/Images/1.png)

![2](https://github.com/vmokook/BigData/blob/main/LR1/Images/2.png) ![3](https://github.com/vmokook/BigData/blob/main/LR1/Images/3.png)     


## 1. Найти велосипед с максимальным временем пробега.

  Для нахождения велосипеда с максимальным временем пробега для начала выполняется группировка данных
`trip.groupBy("bike_id")` о поездках по уникальным значениям в столбце "bike_id". Это позволяет получить 
информацию о всех поездках, связанных с конкретным велосипедом. 
  После группировки применяется функция 'max("duration")', которая позволяет вычислить максимальное значение 
столбце "duration" для каждой группы. Затем результат получает псевдоним "max_duration".
  Далее используется метод orderBy для сортировки результатов в порядке убывания времени пробега.
`col("max_duration").desc()` указывает, что происходит сортировка по столбцу "max_duration" в порядке убывания.
  `.first()` - выбирает первую строку в отсортированных данных. Таким образом, получается велосипед с максимальным временем пробега.
  
![4](https://github.com/vmokook/BigData/blob/main/LR1/Images/4.png)


## 2.Найти наибольшее геодезическое расстояние между станциями.

1. `station_joined` - представляет из себя новую таблицу, для ее создания было выплолнено декартово произведение 
(`cross join`) исходной таблицы station с самой собой. Это было сделано для рассмотрения всех вохможных комбинаций 
по долготе и широте. Данная таблица создается с использованием псевдонимов "st1" и "st2" для каждой копии, чтобы избежать 
конфликтов имен столбцов.

2. Задаемся радиусом Земли для вычисления геодезического расстояния по формуле Хаверсина (https://en.wikipedia.org/wiki/Haversine_formula)

3. Функция `geodesic_distance` принимает 4 параметра (lat1, lon1, lat2, lon2), представляющих собой широту и долготу для двух станций.  
Далее происходит вычисление по формуле. 

3. Создаем пользовательскую функцию (UDF) `geodesic_distance_udf`, используемую для применения функции `geodesic_distance` к столбцам.

4. Добавляем новый столбец "geodesic_distance" к station_joined. Данный столбец вычисляется с использованием geodesic_distance_udf.
Этот столбец представляет собой геодезическое расстояние между каждой парой станций.

5. `max_distance = station_joined_distance.orderBy(col("geodesic_distance").desc()).first():`
Сортируем station_joined_distance в порядке убывания геодезического расстояния и выбираем первую строку с максимальным расстоянием.

![5](https://github.com/vmokook/BigData/blob/main/LR1/Images/5.png )
![6](https://github.com/vmokook/BigData/blob/main/LR1/Images/6.png )




Найти путь велосипеда с максимальным временем пробега через станции.
Найти количество велосипедов в системе.
Найти пользователей потративших на поездки более 3 часов.
